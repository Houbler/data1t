---DDL---
CREATE TABLE IF NOT EXISTS public.products (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(255) NOt NULL,
    price INT NOT NULL
    )
    DISTRIBUTED BY (product_id);
    
CREATE TABLE IF NOT EXISTS public.sales_facts (
    sale_id INT NOT NULL,
    product_id INT NOT NULL,
    sale_date TIMESTAMP NOT NULL,
    quantity INT NOT NULL,
    FOREIGN KEY (product_id) REFERENCES public.products (product_id)
)
DISTRIBUTED BY (sale_id)
PARTITION BY RANGE (sale_date) (
    START ('2024-01-01 00:00:00') INCLUSIVE
    END ('2025-01-01 00:00:00') EXCLUSIVE
    EVERY (INTERVAL '1 month')
);


---DML---
INSERT INTO public.products (product_name, price) VALUES
('Product A', 10),
('Product B', 15),
('Product C', 8),
('Product D', 12),
('Product E', 5);

INSERT INTO public.sales_facts (sale_id, product_id, sale_date, quantity) VALUES
(1, 1, '2024-06-01', 3),
(2, 2, '2024-06-01', 1),
(3, 3, '2024-06-02', 2),
(4, 4, '2024-06-02', 1),
(5, 5, '2024-06-03', 4),
(6, 1, '2024-06-03', 2),
(7, 2, '2024-06-04', 3),
(8, 3, '2024-06-04', 1),
(9, 4, '2024-06-05', 2),
(10, 5, '2024-06-05', 1),
(11, 1, '2024-06-06', 5),
(12, 2, '2024-06-06', 2),
(13, 3, '2024-06-07', 3),
(14, 4, '2024-06-07', 1),
(15, 5, '2024-06-08', 2),
(16, 1, '2024-06-08', 1),
(17, 2, '2024-06-09', 4),
(18, 3, '2024-06-09', 1),
(19, 4, '2024-06-10', 3),
(20, 5, '2024-06-10', 1),
(21, 1, '2024-06-11', 2),
(22, 2, '2024-06-11', 1),
(23, 3, '2024-06-12', 2),
(24, 4, '2024-06-12', 1),
(25, 5, '2024-06-13', 3),
(26, 1, '2024-06-13', 1),
(27, 2, '2024-06-14', 4),
(28, 3, '2024-06-14', 1),
(29, 4, '2024-06-15', 2),
(30, 5, '2024-06-15', 1),
(31, 1, '2024-06-16', 3),
(32, 2, '2024-06-16', 1),
(33, 3, '2024-06-17', 2),
(34, 4, '2024-06-17', 1),
(35, 5, '2024-06-18', 4),
(36, 1, '2024-06-18', 2),
(37, 2, '2024-06-19', 3),
(38, 3, '2024-06-19', 1),
(39, 4, '2024-06-20', 2),
(40, 5, '2024-06-20', 1),
(41, 1, '2024-06-21', 5),
(42, 2, '2024-06-21', 2),
(43, 3, '2024-06-22', 3),
(44, 4, '2024-06-22', 1),
(45, 5, '2024-06-23', 2),
(46, 1, '2024-06-23', 1),
(47, 2, '2024-06-24', 4),
(48, 3, '2024-06-24', 1),
(49, 4, '2024-06-25', 3),
(50, 5, '2024-06-25', 1),
(51, 1, '2024-06-26', 2),
(52, 2, '2024-06-26', 1),
(53, 3, '2024-06-27', 2),
(54, 4, '2024-06-27', 1),
(55, 5, '2024-06-28', 3),
(56, 1, '2024-06-28', 1),
(57, 2, '2024-06-29', 4),
(58, 3, '2024-06-29', 1),
(59, 4, '2024-06-30', 2),
(60, 5, '2024-06-30', 1);

INSERT INTO public.sales_facts (sale_id, product_id, sale_date, quantity) VALUES
(61, 1, '2024-07-01 10:00:00', 3),
(62, 2, '2024-07-01 15:00:00', 1),
(63, 3, '2024-07-02 11:00:00', 2),
(64, 4, '2024-07-02 16:00:00', 1),
(65, 5, '2024-07-03 10:30:00', 4),
(66, 1, '2024-07-03 14:00:00', 2),
(67, 2, '2024-07-04 09:00:00', 3),
(68, 3, '2024-07-04 13:00:00', 1),
(69, 4, '2024-07-05 10:15:00', 2),
(70, 5, '2024-07-05 14:45:00', 1),
(71, 1, '2024-07-06 11:00:00', 5),
(72, 2, '2024-07-06 15:30:00', 2),
(73, 3, '2024-07-07 09:45:00', 3),
(74, 4, '2024-07-07 12:00:00', 1),
(75, 5, '2024-07-08 10:30:00', 2),
(76, 1, '2024-07-08 14:15:00', 1),
(77, 2, '2024-07-09 11:00:00', 4),
(78, 3, '2024-07-09 13:45:00', 1),
(79, 4, '2024-07-10 09:00:00', 3),
(80, 5, '2024-07-10 16:00:00', 1),
(81, 1, '2024-07-11 10:00:00', 2),
(82, 2, '2024-07-11 15:00:00', 1),
(83, 3, '2024-07-12 11:00:00', 2),
(84, 4, '2024-07-12 16:00:00', 1),
(85, 5, '2024-07-13 10:30:00', 3),
(86, 1, '2024-07-13 14:00:00', 1),
(87, 2, '2024-07-14 09:00:00', 4),
(88, 3, '2024-07-14 13:00:00', 1),
(89, 4, '2024-07-15 10:15:00', 2),
(90, 5, '2024-07-15 14:45:00', 1),
(91, 1, '2024-07-16 11:00:00', 3),
(92, 2, '2024-07-16 15:30:00', 2),
(93, 3, '2024-07-17 09:45:00', 1),
(94, 4, '2024-07-17 12:00:00', 1),
(95, 5, '2024-07-18 10:30:00', 2),
(96, 1, '2024-07-18 14:15:00', 1),
(97, 2, '2024-07-19 11:00:00', 3),
(98, 3, '2024-07-19 13:45:00', 1),
(99, 4, '2024-07-20 09:00:00', 2),
(100, 5, '2024-07-20 16:00:00', 1),
(101, 1, '2024-07-21 10:00:00', 5),
(102, 2, '2024-07-21 15:00:00', 2),
(103, 3, '2024-07-22 11:00:00', 3),
(104, 4, '2024-07-22 16:00:00', 1),
(105, 5, '2024-07-23 10:30:00', 2),
(106, 1, '2024-07-23 14:00:00', 1),
(107, 2, '2024-07-24 09:00:00', 4),
(108, 3, '2024-07-24 13:00:00', 1),
(109, 4, '2024-07-25 10:15:00', 3),
(110, 5, '2024-07-25 14:45:00', 1),
(111, 1, '2024-07-26 11:00:00', 2),
(112, 2, '2024-07-26 15:30:00', 1),
(113, 3, '2024-07-27 09:45:00', 1),
(114, 4, '2024-07-27 12:00:00', 1),
(115, 5, '2024-07-28 10:30:00', 3),
(116, 1, '2024-07-28 14:15:00', 1),
(117, 2, '2024-07-29 11:00:00', 2),
(118, 3, '2024-07-29 13:45:00', 1),
(119, 4, '2024-07-30 09:00:00', 1),
(120, 5, '2024-07-30 16:00:00', 1),
(121, 1, '2024-07-31 10:00:00', 2),
(122, 2, '2024-07-31 15:00:00', 1);

---query---
SET optimizer = ON;

SELECT p.product_name, SUM(quantity) AS total_sales_amount
FROM sales_facts sf 
JOIN products p ON sf.product_id = p.product_id 
WHERE p.product_id = 1 OR p.product_id = 2 AND sf.sale_date BETWEEN '2024-06-15' AND '2024-07-15'
GROUP BY p.product_name
ORDER BY p.product_name ASC

EXPLAIN SELECT p.product_name, SUM(quantity) AS total_sales_amount
FROM sales_facts sf 
JOIN products p ON sf.product_id = p.product_id 
WHERE p.product_id = 1 OR p.product_id = 2 AND sf.sale_date BETWEEN '2024-06-15' AND '2024-07-15'
GROUP BY p.product_name
ORDER BY p.product_name ASC
